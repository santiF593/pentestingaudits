function validateForm() {
  let isValid = true;

  // Validar email, nombre, asunto y mensaje
  const email = document.contactForm.email.value;
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if (!emailPattern.test(email)) {
    document.querySelector(".email-error").style.display = "block";
    isValid = false;
  } else {
    document.querySelector(".email-error").style.display = "none";
  }

  const name = document.contactForm.name.value;
  if (name.trim() === "") {
    document.querySelector(".name-error").style.display = "block";
    isValid = false;
  } else {
    document.querySelector(".name-error").style.display = "none";
  }

  const subject = document.contactForm.subject.value;
  if (subject.trim() === "") {
    document.querySelector(".subject-error").style.display = "block";
    isValid = false;
  } else {
    document.querySelector(".subject-error").style.display = "none";
  }

  const message = document.contactForm.message.value;
  if (message.trim() === "") {
    document.querySelector(".message-error").style.display = "block";
    isValid = false;
  } else {
    document.querySelector(".message-error").style.display = "none";
  }

  // Validar campo oculto anti-automatización
  const antiBotField = document.contactForm.anti_bot.value;
  if (antiBotField !== "") {
    isValid = false;
  }

  // Validar reCAPTCHA
  const captcha = grecaptcha.getResponse();
  if (captcha === "") {
    document.querySelector(".captcha-error").style.display = "block";
    isValid = false;
  } else {
    document.querySelector(".captcha-error").style.display = "none";
  }

  // Validar contra XSS
  const elementsToValidate = [email, name, subject, message];
  for (const element of elementsToValidate) {
    if (isXSS(element)) {
      isValid = false;
      break;
    }
  }

  // Resto del código para enviar el formulario o realizar otras acciones

  return isValid;
}

function isXSS(input) {
  const regex = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;
  return regex.test(input);
}

function escapeHTML(unsafeString) {
  return unsafeString.replace(/[&<"']/g, function (match) {
    switch (match) {
      case "&":
        return "&amp;";
      case "<":
        return "&lt;";
      case ">":
        return "&gt;";
      case '"':
        return "&quot;";
      case "'":
        return "&#x27;";
      default:
        return match;
    }
  });
}
